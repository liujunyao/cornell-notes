<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å¤ä¹ é¡µé¢ - åº·å¥ˆå°”ç¬”è®°å­¦ä¹ åŠ©æ‰‹</title>
  <link rel="stylesheet" href="../css/design-system.css">
  <style>
    /* å¤ä¹ é¡µé¢ç‰¹å®šæ ·å¼ */
    .review-page {
      padding-top: var(--header-height);
      padding-bottom: var(--footer-height);
      height: 100vh;
      display: flex;
      flex-direction: column;
      background: var(--color-white);
    }

    .review-header {
      height: var(--header-height);
      background: var(--color-white);
      box-shadow: var(--shadow-sm);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 var(--spacing-md);
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 1000;
    }

    .review-title {
      font-size: var(--font-size-h2-mobile);
      font-weight: 700;
      color: var(--color-gray-900);
      flex: 1;
      text-align: center;
    }

    .mode-selector {
      display: flex;
      gap: var(--spacing-sm);
      padding: var(--spacing-md);
      background: var(--color-background);
      border-bottom: 1px solid var(--color-gray-300);
    }

    .mode-btn {
      flex: 1;
      padding: var(--spacing-sm) var(--spacing-md);
      border: 1px solid var(--color-gray-300);
      border-radius: var(--radius-sm);
      background: var(--color-white);
      color: var(--color-gray-700);
      font-size: var(--font-size-base-mobile);
      font-weight: 500;
      cursor: pointer;
      transition: all var(--transition-base);
      text-align: center;
    }

    .mode-btn:hover {
      border-color: var(--color-primary);
      color: var(--color-primary);
    }

    .mode-btn.active {
      background: var(--color-primary);
      color: var(--color-white);
      border-color: var(--color-primary);
    }

    .review-content {
      flex: 1;
      display: flex;
      overflow: hidden;
      padding: var(--spacing-md);
      gap: var(--spacing-md);
    }

    /* åŸºç¡€æ¨¡å¼ï¼šé®ç›–å¼èƒŒè¯µ */
    .basic-mode {
      display: flex;
      gap: var(--spacing-md);
      width: 100%;
    }

    .cue-panel {
      width: 30%;
      background: var(--color-sidebar);  /* ä½¿ç”¨æ–°çš„ä¾§è¾¹æ é¢œè‰² */
      border-radius: var(--radius-md);
      padding: var(--spacing-md);
      overflow-y: auto;
    }

    .cue-panel-title {
      font-size: var(--font-size-h2-mobile);
      font-weight: 700;
      color: var(--color-gray-900);
      margin-bottom: var(--spacing-md);
    }

    .cue-item {
      padding: var(--spacing-sm);
      margin-bottom: var(--spacing-sm);
      background: var(--color-white);
      border-radius: var(--radius-sm);
      font-size: var(--font-size-base-mobile);
      line-height: var(--line-height-normal);
      color: var(--color-gray-900);
    }

    .note-panel {
      flex: 1;
      background: var(--color-white);
      border: 1px solid var(--color-gray-300);
      border-radius: var(--radius-md);
      padding: var(--spacing-lg);
      overflow-y: auto;
      position: relative;
    }

    .note-line {
      padding: var(--spacing-sm) 0;
      font-size: var(--font-size-base-desktop);
      line-height: var(--line-height-loose);
      color: var(--color-gray-900);
      position: relative;
      border-bottom: 1px solid var(--color-gray-300);
      transition: all var(--transition-base);
    }

    .note-line.covered {
      background: linear-gradient(90deg,
        rgba(58, 110, 165, 0.1) 0%,
        rgba(58, 110, 165, 0.05) 100%);
      color: transparent;
      text-shadow: 0 0 8px rgba(0, 0, 0, 0.5);
      cursor: pointer;
      user-select: none;
    }

    .note-line.covered:hover {
      background: linear-gradient(90deg,
        rgba(58, 110, 165, 0.15) 0%,
        rgba(58, 110, 165, 0.08) 100%);
    }

    .note-line.covered::after {
      content: 'ç‚¹å‡»è§£é”';
      position: absolute;
      right: var(--spacing-md);
      top: 50%;
      transform: translateY(-50%);
      font-size: var(--font-size-small-mobile);
      color: var(--color-primary);
      opacity: 0.7;
    }

    .note-line.revealed {
      animation: reveal 0.3s ease-out;
    }

    @keyframes reveal {
      from {
        opacity: 0;
        transform: translateX(-10px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    .unlock-btn {
      position: fixed;
      bottom: calc(var(--footer-height) + var(--spacing-md));
      right: var(--spacing-md);
      width: 56px;
      height: 56px;
      border-radius: var(--radius-full);
      background: var(--color-primary);
      color: white;
      border: none;
      box-shadow: var(--shadow-lg);
      font-size: 24px;
      cursor: pointer;
      transition: all var(--transition-base);
      z-index: 100;
    }

    .unlock-btn:hover {
      transform: scale(1.1);
      box-shadow: 0 12px 20px rgba(0, 0, 0, 0.2);
    }

    .unlock-btn:active {
      transform: scale(0.95);
    }

    /* åº•éƒ¨æ“ä½œæ  */
    .review-actions {
      height: var(--footer-height);
      background: var(--color-white);
      box-shadow: 0 -1px 3px rgba(0, 0, 0, 0.1);
      display: flex;
      align-items: center;
      justify-content: space-around;
      padding: 0 var(--spacing-md);
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      z-index: 1000;
    }

    .action-btn {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
      padding: var(--spacing-sm);
      border: none;
      background: transparent;
      color: var(--color-gray-700);
      font-size: var(--font-size-small-mobile);
      cursor: pointer;
      transition: color var(--transition-base);
    }

    .action-btn:hover {
      color: var(--color-primary);
    }

    .action-btn-icon {
      font-size: 24px;
    }

    .action-btn.marked {
      color: var(--color-emphasis);
    }

    /* å¤ä¹ æŠ¥å‘Šæ¨¡æ€æ¡† */
    .modal-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      z-index: 2000;
      align-items: center;
      justify-content: center;
      padding: var(--spacing-md);
    }

    .modal-overlay.show {
      display: flex;
    }

    .review-report {
      background: var(--color-white);
      border-radius: var(--radius-lg);
      padding: var(--spacing-lg);
      max-width: 500px;
      width: 100%;
      box-shadow: var(--shadow-lg);
      animation: modalSlideIn 0.3s ease-out;
    }

    @keyframes modalSlideIn {
      from {
        opacity: 0;
        transform: translateY(-20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .report-header {
      text-align: center;
      margin-bottom: var(--spacing-lg);
    }

    .report-title {
      font-size: var(--font-size-h1-mobile);
      font-weight: 700;
      color: var(--color-gray-900);
      margin-bottom: var(--spacing-sm);
    }

    .report-icon {
      font-size: 48px;
      margin-bottom: var(--spacing-sm);
    }

    .report-stats {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: var(--spacing-md);
      margin-bottom: var(--spacing-lg);
    }

    .stat-item {
      background: var(--color-background);
      padding: var(--spacing-md);
      border-radius: var(--radius-md);
      text-align: center;
    }

    .stat-value {
      font-size: 28px;
      font-weight: 700;
      color: var(--color-primary);
      margin-bottom: 4px;
    }

    .stat-label {
      font-size: var(--font-size-small-mobile);
      color: var(--color-gray-500);
    }

    .weak-points {
      margin-bottom: var(--spacing-lg);
    }

    .weak-points-title {
      font-size: var(--font-size-base-desktop);
      font-weight: 600;
      color: var(--color-gray-900);
      margin-bottom: var(--spacing-sm);
    }

    .weak-point-item {
      padding: var(--spacing-sm);
      background: var(--color-background);
      border-left: 3px solid var(--color-emphasis);
      margin-bottom: var(--spacing-sm);
      font-size: var(--font-size-base-mobile);
      color: var(--color-gray-700);
    }

    .report-actions {
      display: flex;
      gap: var(--spacing-sm);
    }

    .report-btn {
      flex: 1;
      padding: var(--spacing-md);
      border: none;
      border-radius: var(--radius-sm);
      font-size: var(--font-size-base-mobile);
      font-weight: 600;
      cursor: pointer;
      transition: all var(--transition-base);
    }

    .report-btn-mastered {
      background: var(--color-success);
      color: white;
    }

    .report-btn-mastered:hover {
      background: #229954;
      transform: translateY(-1px);
    }

    .report-btn-not-mastered {
      background: var(--color-emphasis);
      color: white;
    }

    .report-btn-not-mastered:hover {
      background: #d35400;
      transform: translateY(-1px);
    }

    /* è¿›åº¦æŒ‡ç¤ºå™¨ */
    .progress-bar {
      position: fixed;
      top: var(--header-height);
      left: 0;
      right: 0;
      height: 4px;
      background: var(--color-gray-300);
      z-index: 999;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--color-primary) 0%, var(--color-success) 100%);
      transition: width var(--transition-slow);
    }

    /* å“åº”å¼ */
    @media (max-width: 767px) {
      .basic-mode {
        flex-direction: column;
      }

      .cue-panel {
        width: 100%;
        max-height: 30%;
      }

      .note-panel {
        flex: 1;
      }

      .unlock-btn {
        bottom: calc(var(--footer-height) + var(--spacing-sm));
        right: var(--spacing-sm);
        width: 48px;
        height: 48px;
      }
    }
  </style>
</head>
<body>
  <div class="review-page">
    <!-- é¡¶éƒ¨æ ‡é¢˜æ  -->
    <header class="review-header">
      <button class="btn btn-secondary" onclick="window.location.href='index.html'">
        â† è¿”å›
      </button>
      <h1 class="review-title">åº·å¥ˆå°”ç¬”è®°æ³•ä»‹ç»</h1>
      <button class="btn btn-danger" id="exitBtn">
        é€€å‡º
      </button>
    </header>

    <!-- è¿›åº¦æ¡ -->
    <div class="progress-bar">
      <div class="progress-fill" id="progressFill" style="width: 0%"></div>
    </div>

    <!-- æ¨¡å¼é€‰æ‹©å™¨ -->
    <div class="mode-selector">
      <button class="mode-btn active" data-mode="basic">
        ğŸ“ åŸºç¡€æ¨¡å¼
      </button>
      <button class="mode-btn" data-mode="advanced">
        ğŸ¯ è¿›é˜¶æ¨¡å¼
      </button>
      <button class="mode-btn" data-mode="high-level">
        ğŸ† é«˜é˜¶æ¨¡å¼
      </button>
    </div>

    <!-- å¤ä¹ å†…å®¹åŒºåŸŸ -->
    <div class="review-content">
      <!-- åŸºç¡€æ¨¡å¼ï¼šé®ç›–å¼èƒŒè¯µ -->
      <div class="basic-mode">
        <!-- çº¿ç´¢é¢æ¿ -->
        <div class="cue-panel">
          <h2 class="cue-panel-title">ğŸ“Œ çº¿ç´¢æç¤º</h2>
          <div class="cue-item">ä»€ä¹ˆæ˜¯åº·å¥ˆå°”ç¬”è®°æ³•ï¼Ÿ</div>
          <div class="cue-item">5R æµç¨‹æ˜¯ä»€ä¹ˆï¼Ÿ</div>
          <div class="cue-item">å¦‚ä½•æœ‰æ•ˆä½¿ç”¨çº¿ç´¢æ ï¼Ÿ</div>
          <div class="cue-item">ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ä¸‰åˆ†æ å¸ƒå±€ï¼Ÿ</div>
        </div>

        <!-- ç¬”è®°é¢æ¿ï¼ˆé®ç›–ï¼‰ -->
        <div class="note-panel">
          <div class="note-line covered" data-line="1">
            åº·å¥ˆå°”ç¬”è®°æ³•æ˜¯ä¸€ç§ç³»ç»ŸåŒ–çš„ç¬”è®°æ–¹æ³•ï¼Œç”±åº·å¥ˆå°”å¤§å­¦æ•™æˆ Walter Pauk äº 1950 å¹´ä»£å‘æ˜ã€‚
          </div>
          <div class="note-line covered" data-line="2">
            è¯¥æ–¹æ³•çš„æ ¸å¿ƒæ˜¯å°†ç¬”è®°é¡µé¢åˆ†ä¸ºä¸‰ä¸ªåŒºåŸŸï¼šçº¿ç´¢æ ï¼ˆ25%ï¼‰ã€ç¬”è®°æ ï¼ˆ75%ï¼‰å’Œæ€»ç»“æ ï¼ˆåº•éƒ¨ï¼‰ã€‚
          </div>
          <div class="note-line covered" data-line="3">
            5R æµç¨‹åŒ…æ‹¬ï¼šRecordï¼ˆè®°å½•ï¼‰ã€Reduceï¼ˆç®€åŒ–ï¼‰ã€Reciteï¼ˆèƒŒè¯µï¼‰ã€Reflectï¼ˆåæ€ï¼‰ã€Reviewï¼ˆå¤ä¹ ï¼‰ã€‚
          </div>
          <div class="note-line covered" data-line="4">
            çº¿ç´¢æ çš„å…³é”®æ˜¯æå‡ºé—®é¢˜å’Œè®°å½•å…³é”®è¯ï¼Œå¼•å¯¼ä¸»åŠ¨æ€è€ƒã€‚
          </div>
          <div class="note-line covered" data-line="5">
            ç¬”è®°æ ç”¨äºè®°å½•è¯¾å ‚å†…å®¹ã€è®²åº§ç¬”è®°æˆ–é˜…è¯»è¦ç‚¹ï¼Œéœ€è¦è¯¦ç»†è®°å½•ã€‚
          </div>
          <div class="note-line covered" data-line="6">
            æ€»ç»“æ ç”¨äºæ¦‚æ‹¬æ€»ç»“æœ¬é¡µçš„æ ¸å¿ƒå†…å®¹ï¼Œç”¨è‡ªå·±çš„è¯è¡¨è¾¾ã€‚
          </div>
          <div class="note-line covered" data-line="7">
            åº·å¥ˆå°”ç¬”è®°æ³•æœ‰æ•ˆçš„åŸå› æ˜¯å®ƒå°†è¢«åŠ¨æ¥æ”¶è½¬å˜ä¸ºä¸»åŠ¨æ€è€ƒï¼Œç¬¦åˆè®¤çŸ¥ç§‘å­¦åŸç†ã€‚
          </div>
          <div class="note-line covered" data-line="8">
            ä½¿ç”¨ä¸‰åˆ†æ å¸ƒå±€å¯ä»¥å¸®åŠ©å­¦ç”Ÿç³»ç»ŸåŒ–æ•´ç†çŸ¥è¯†ï¼Œä¾¿äºå®šæœŸå¤ä¹ å’Œè®°å¿†ã€‚
          </div>
        </div>
      </div>
    </div>

    <!-- è§£é”ä¸‹ä¸€è¡ŒæŒ‰é’® -->
    <button class="unlock-btn" id="unlockBtn" title="è§£é”ä¸‹ä¸€è¡Œ">
      ğŸ”“
    </button>

    <!-- åº•éƒ¨æ“ä½œæ  -->
    <div class="review-actions">
      <button class="action-btn" id="prevBtn">
        <span class="action-btn-icon">â¬†ï¸</span>
        <span>ä¸Šä¸€è¡Œ</span>
      </button>
      <button class="action-btn" id="nextBtn">
        <span class="action-btn-icon">â¬‡ï¸</span>
        <span>ä¸‹ä¸€è¡Œ</span>
      </button>
      <button class="action-btn" id="markBtn">
        <span class="action-btn-icon">â­</span>
        <span>è–„å¼±ç‚¹</span>
      </button>
      <button class="action-btn" id="finishBtn">
        <span class="action-btn-icon">âœ…</span>
        <span>å®Œæˆå¤ä¹ </span>
      </button>
    </div>
  </div>

  <!-- å¤ä¹ æŠ¥å‘Šæ¨¡æ€æ¡† -->
  <div class="modal-overlay" id="reportModal">
    <div class="review-report">
      <div class="report-header">
        <div class="report-icon">âœ…</div>
        <h2 class="report-title">å¤ä¹ å®Œæˆï¼</h2>
      </div>

      <div class="report-stats">
        <div class="stat-item">
          <div class="stat-value" id="timeSpent">15åˆ†8ç§’</div>
          <div class="stat-label">å¤ä¹ æ—¶é•¿</div>
        </div>
        <div class="stat-item">
          <div class="stat-value" id="accuracy">82%</div>
          <div class="stat-label">æ­£ç¡®ç‡</div>
        </div>
      </div>

      <div class="weak-points">
        <div class="weak-points-title">ğŸ“Œ è–„å¼±ç‚¹ (2ä¸ª)</div>
        <div class="weak-point-item">åº·å¥ˆå°”ç¬”è®°æ³•çš„å®šä¹‰</div>
        <div class="weak-point-item">5R æµç¨‹çš„å…·ä½“åº”ç”¨</div>
      </div>

      <div class="report-actions">
        <button class="report-btn report-btn-mastered" id="masteredBtn">
          âœ“ å·²æŒæ¡
        </button>
        <button class="report-btn report-btn-not-mastered" id="notMasteredBtn">
          âœ— æœªæŒæ¡
        </button>
      </div>
    </div>
  </div>

  <script>
    // å…¨å±€çŠ¶æ€
    let currentLine = 0;
    let revealedLines = [];
    let markedWeakPoints = [];
    let startTime = Date.now();

    const noteLines = document.querySelectorAll('.note-line');
    const totalLines = noteLines.length;
    const progressFill = document.getElementById('progressFill');
    const reportModal = document.getElementById('reportModal');

    // æ›´æ–°è¿›åº¦æ¡
    function updateProgress() {
      const progress = (revealedLines.length / totalLines) * 100;
      progressFill.style.width = `${progress}%`;
    }

    // è§£é”ä¸€è¡Œ
    function revealLine(lineElement) {
      if (!lineElement.classList.contains('covered')) return;

      lineElement.classList.remove('covered');
      lineElement.classList.add('revealed');

      const lineNum = parseInt(lineElement.dataset.line);
      if (!revealedLines.includes(lineNum)) {
        revealedLines.push(lineNum);
        updateProgress();
      }
    }

    // ç‚¹å‡»ç¬”è®°è¡Œè§£é”
    noteLines.forEach(line => {
      line.addEventListener('click', () => {
        revealLine(line);
      });
    });

    // è§£é”æŒ‰é’® - è§£é”ä¸‹ä¸€ä¸ªæœªè§£é”çš„è¡Œ
    document.getElementById('unlockBtn').addEventListener('click', () => {
      const coveredLines = Array.from(noteLines).filter(line =>
        line.classList.contains('covered')
      );

      if (coveredLines.length > 0) {
        revealLine(coveredLines[0]);
        coveredLines[0].scrollIntoView({ behavior: 'smooth', block: 'center' });
      }
    });

    // ä¸Šä¸€è¡Œ
    document.getElementById('prevBtn').addEventListener('click', () => {
      if (currentLine > 0) {
        currentLine--;
        noteLines[currentLine].scrollIntoView({ behavior: 'smooth', block: 'center' });
      }
    });

    // ä¸‹ä¸€è¡Œ
    document.getElementById('nextBtn').addEventListener('click', () => {
      if (currentLine < totalLines - 1) {
        currentLine++;
        noteLines[currentLine].scrollIntoView({ behavior: 'smooth', block: 'center' });
      }
    });

    // æ ‡è®°è–„å¼±ç‚¹
    document.getElementById('markBtn').addEventListener('click', () => {
      const currentLineElement = noteLines[currentLine];
      const lineNum = parseInt(currentLineElement.dataset.line);

      const btn = document.getElementById('markBtn');

      if (markedWeakPoints.includes(lineNum)) {
        // å–æ¶ˆæ ‡è®°
        markedWeakPoints = markedWeakPoints.filter(l => l !== lineNum);
        btn.classList.remove('marked');
        currentLineElement.style.borderLeft = 'none';
      } else {
        // æ·»åŠ æ ‡è®°
        markedWeakPoints.push(lineNum);
        btn.classList.add('marked');
        currentLineElement.style.borderLeft = '4px solid var(--color-emphasis)';
      }
    });

    // å®Œæˆå¤ä¹ 
    document.getElementById('finishBtn').addEventListener('click', () => {
      // è®¡ç®—å¤ä¹ æ—¶é•¿
      const timeSpent = Math.floor((Date.now() - startTime) / 1000);
      const minutes = Math.floor(timeSpent / 60);
      const seconds = timeSpent % 60;
      document.getElementById('timeSpent').textContent = `${minutes}åˆ†${seconds}ç§’`;

      // è®¡ç®—æ­£ç¡®ç‡ï¼ˆç¤ºä¾‹ï¼‰
      const accuracy = Math.floor((revealedLines.length / totalLines) * 100);
      document.getElementById('accuracy').textContent = `${accuracy}%`;

      // æ˜¾ç¤ºæŠ¥å‘Š
      reportModal.classList.add('show');
    });

    // å·²æŒæ¡
    document.getElementById('masteredBtn').addEventListener('click', () => {
      alert('å·²æ ‡è®°ä¸º"å·²æŒæ¡"ï¼Œä¸‹æ¬¡å¤ä¹ æ—¶é—´å»¶é•¿è‡³ 15 å¤©å');
      window.location.href = 'index.html';
    });

    // æœªæŒæ¡
    document.getElementById('notMasteredBtn').addEventListener('click', () => {
      alert('å·²æ ‡è®°ä¸º"æœªæŒæ¡"ï¼Œå·²åŠ å…¥æ˜æ—¥å¤ä¹ æ¸…å•');
      window.location.href = 'index.html';
    });

    // é€€å‡ºæŒ‰é’®
    document.getElementById('exitBtn').addEventListener('click', () => {
      if (confirm('ç¡®å®šè¦é€€å‡ºå¤ä¹ å—ï¼Ÿå½“å‰è¿›åº¦å°†ä¸ä¼šä¿å­˜ã€‚')) {
        window.location.href = 'index.html';
      }
    });

    // æ¨¡å¼åˆ‡æ¢ï¼ˆå ä½ï¼‰
    document.querySelectorAll('.mode-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');

        const mode = btn.dataset.mode;
        if (mode !== 'basic') {
          alert(`${btn.textContent.trim()} å¼€å‘ä¸­...`);
        }
      });
    });

    // é”®ç›˜å¿«æ·é”®
    document.addEventListener('keydown', (e) => {
      if (e.key === 'ArrowUp') {
        document.getElementById('prevBtn').click();
      } else if (e.key === 'ArrowDown') {
        document.getElementById('nextBtn').click();
      } else if (e.key === ' ') {
        e.preventDefault();
        document.getElementById('unlockBtn').click();
      } else if (e.key === 's' || e.key === 'S') {
        document.getElementById('markBtn').click();
      }
    });

    // åˆå§‹åŒ–æç¤º
    console.log('å¤ä¹ é¡µé¢å·²åŠ è½½');
    console.log('å¿«æ·é”®ï¼šâ†‘/â†“ åˆ‡æ¢è¡Œï¼Œç©ºæ ¼ è§£é”ï¼ŒS æ ‡è®°è–„å¼±ç‚¹');
  </script>
</body>
</html>
