<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ç¬”è®°ç¼–è¾‘ - åº·å¥ˆå°”ç¬”è®°å­¦ä¹ åŠ©æ‰‹</title>
  <link rel="stylesheet" href="../css/design-system.css">
  <style>
    /* ç¬”è®°ç¼–è¾‘é¡µç‰¹å®šæ ·å¼ */
    .editor-page {
      padding-top: var(--header-height);
      padding-bottom: 0;
      height: 100vh;
      display: flex;
      flex-direction: column;
    }

    .editor-header {
      height: var(--header-height);
      background: var(--color-white);
      box-shadow: var(--shadow-sm);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 var(--spacing-md);
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 1000;
    }

    .editor-title-input {
      flex: 1;
      border: none;
      font-size: var(--font-size-h1-mobile);
      font-weight: 700;
      padding: var(--spacing-sm);
      margin: 0 var(--spacing-md);
    }

    .editor-title-input:focus {
      outline: none;
      background: var(--color-background);
      border-radius: var(--radius-sm);
    }

    .editor-actions {
      display: flex;
      gap: var(--spacing-sm);
      align-items: center;
    }

    .editor-actions .save-status {
      font-size: var(--font-size-small-mobile);
      color: var(--color-gray-500);
      margin-right: var(--spacing-sm);
    }

    .editor-container {
      flex: 1;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    /* ä¸‰åˆ†æ å¸ƒå±€ - çº¿ç´¢æ  | ç¬”è®°æ ï¼ˆç»å…¸æ¨¡å¼ä¸‹ï¼‰ + æ€»ç»“æ åœ¨ä¸‹æ–¹ */
    .editor-three-columns {
      display: flex;
      flex: 1;
      width: 100%;
      overflow: hidden;
      flex-wrap: wrap;  /* å…è®¸æ¢è¡Œ */
    }

    /* ç»å…¸æ¨¡å¼ - ä¸¤è¡Œä¸‰åˆ— */
    /* ç¬¬ä¸€è¡Œï¼šçº¿ç´¢æ (20%) + ç¬”è®°æ (80%) */
    .cue-column {
      width: 20%;
      background: var(--color-sidebar);
      border-right: 1px solid var(--color-gray-300);
      display: flex;
      flex-direction: column;
      overflow-y: auto;
      transition: width var(--transition-base), border var(--transition-base), padding var(--transition-base);
    }

    .note-column {
      width: 80%;
      display: flex;
      flex-direction: column;
      background: var(--color-white);
      transition: width var(--transition-base);
      flex: 1;
    }

    /* ç¬¬äºŒè¡Œï¼šæ€»ç»“æ (100%) - é»˜è®¤å æ»¡å®½åº¦ */
    .summary-row {
      width: 100%;
      order: 10;  /* ç¡®ä¿åœ¨æœ€å */
      height: 20%;
      border-top: 2px solid var(--color-gray-300);
      background: var(--color-sidebar);
      display: flex;
      flex-direction: column;
      transition: height var(--transition-base), width var(--transition-base), border var(--transition-base), padding var(--transition-base);
    }

    /* å®½å±æ¨¡å¼ï¼šä¸‰æ ä¸€è¡Œ */
    @media (min-width: 1024px) {
      .editor-three-columns {
        flex-wrap: nowrap;  /* ç¦æ­¢æ¢è¡Œ */
        gap: 0;
      }

      .cue-column {
        width: 15%;
        flex-wrap: nowrap;
      }

      .note-column {
        width: 65%;
        flex-wrap: nowrap;
      }

      .summary-row {
        width: 20%;
        order: 0;  /* ä¸ç”¨æ’åºï¼Œç›´æ¥è·Ÿåœ¨ç¬”è®°æ å */
        height: auto;
        border-top: none;
        border-left: 1px solid var(--color-gray-300);
        flex-shrink: 0;
      }

      /* ä¸“æ³¨æ¨¡å¼ï¼šè¾…åŠ©æ æŠ˜å æ—¶ï¼Œç¬”è®°æ å æ»¡ */
      .editor-three-columns.focus-mode .note-column {
        width: 100% !important;
      }
    }

    /* è¶…å®½å±æ¨¡å¼ï¼šä¼˜åŒ–æ¯”ä¾‹ */
    @media (min-width: 1600px) {
      .cue-column {
        width: 15%;
      }

      .note-column {
        width: 65%;
      }

      .summary-row {
        width: 20%;
      }
    }

    .cue-column-header {
      padding: var(--spacing-sm) var(--spacing-md);
      background: var(--color-white);
      border-bottom: 1px solid var(--color-gray-300);
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: var(--spacing-sm);
      min-height: 52px;
    }

    .cue-column-title {
      font-size: var(--font-size-h2-mobile);
      font-weight: 700;
      color: var(--color-gray-900);
      flex: 1;
    }

    .collapse-btn {
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      border: none;
      background: var(--color-background);
      cursor: pointer;
      border-radius: var(--radius-sm);
      transition: all var(--transition-fast);
      font-size: 16px;
      padding: 0;
    }

    .collapse-btn:hover {
      background: var(--color-gray-300);
    }

    .cue-column.collapsed {
      width: 0 !important;
      min-width: 0;
      overflow: hidden;
      border-right: none;
      padding: 0;
    }

    .cue-column.collapsed .cue-column-header,
    .cue-column.collapsed .cue-column-content {
      display: none;
    }

    .summary-row.collapsed {
      height: 0 !important;
      min-height: 0;
      overflow: hidden;
      border-top: none;
      border-left: none;
      padding: 0;
    }

    .summary-row.collapsed .summary-row-header,
    .summary-row.collapsed .summary-content {
      display: none;
    }

    /* å®½å±æ¨¡å¼ä¸‹çš„æŠ˜å æ ·å¼ */
    @media (min-width: 1024px) {
      .cue-column.collapsed {
        border-right: none;
        border-left: none;
      }

      .summary-row.collapsed {
        width: 0 !important;
        min-width: 0;
        border-left: none;
      }
    }

    .cue-column-content {
      flex: 1;
      padding: var(--spacing-md);
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: var(--spacing-sm);
    }

    .cue-textarea {
      width: 100%;
      height: 100%;
      flex: 1;
      border: none;
      resize: none;
      font-family: var(--font-family-base);
      font-size: var(--font-size-base-mobile);
      line-height: 1.8;
      background: transparent;
      color: var(--color-gray-900);
      padding: 0;
      margin: 0;
    }

    .cue-textarea:focus {
      outline: none;
    }

    .ai-generate-btn {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: var(--spacing-sm) var(--spacing-md);
      border-radius: var(--radius-sm);
      font-size: var(--font-size-small-desktop);
      display: inline-flex;
      align-items: center;
      gap: var(--spacing-xs);
      cursor: pointer;
      border: none;
      transition: transform var(--transition-base);
    }

    .ai-generate-btn:hover {
      transform: translateY(-1px);
    }

    .toolbar {
      display: flex;
      gap: var(--spacing-xs);
      padding: var(--spacing-sm) var(--spacing-md);
      background: var(--color-white);
      border-bottom: 1px solid var(--color-gray-300);
      flex-wrap: wrap;
      min-height: 52px;
    }

    .toolbar-btn {
      width: 36px;
      height: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
      border: 1px solid var(--color-gray-300);
      border-radius: var(--radius-sm);
      background: var(--color-white);
      cursor: pointer;
      transition: all var(--transition-fast);
      font-size: 16px;
    }

    .toolbar-btn:hover {
      background: var(--color-primary);
      color: white;
      border-color: var(--color-primary);
    }

    .toolbar-btn.active {
      background: var(--color-primary);
      color: white;
    }

    .ai-feature-btn {
      font-size: 18px;
    }

    /* æ·±åº¦æ¢ç´¢å¯¹è¯é¢æ¿ - æµ®åŠ¨å±‚ */
    .explore-chat-panel {
      position: fixed;
      right: -400px;
      top: var(--header-height);
      bottom: 0;
      width: 400px;
      background: var(--color-white);
      box-shadow: -4px 0 24px rgba(0, 0, 0, 0.15);
      display: flex;
      flex-direction: column;
      z-index: 1000;
      transition: right var(--transition-base);
    }

    .explore-chat-panel.open {
      right: 0;
    }

    .explore-chat-header {
      padding: var(--spacing-md);
      background: var(--color-white);
      border-bottom: 1px solid var(--color-gray-300);
      display: flex;
      align-items: center;
      justify-content: space-between;
      min-height: 56px;
    }

    .explore-chat-title {
      font-size: var(--font-size-h2-mobile);
      font-weight: 700;
      color: var(--color-gray-900);
      margin: 0;
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
    }

    .explore-chat-close-btn {
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--color-background);
      border: none;
      border-radius: var(--radius-sm);
      cursor: pointer;
      transition: all var(--transition-fast);
      font-size: 18px;
    }

    .explore-chat-close-btn:hover {
      background: var(--color-gray-300);
    }

    /* å¯¹è¯å†…å®¹åŒºåŸŸ */
    .explore-chat-content {
      flex: 1;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .explore-chat-messages {
      flex: 1;
      overflow-y: auto;
      padding: var(--spacing-md);
      display: flex;
      flex-direction: column;
      gap: var(--spacing-md);
    }

    /* å¯¹è¯æ¶ˆæ¯æ ·å¼ - QAå½¢å¼ */
    .chat-qa-item {
      display: flex;
      flex-direction: column;
      gap: var(--spacing-sm);
      padding: var(--spacing-md);
      background: var(--color-background);
      border-radius: var(--radius-md);
      animation: slideIn 0.3s ease-out;
    }

    .chat-question {
      display: flex;
      flex-direction: column;
      gap: var(--spacing-xs);
    }

    .chat-question-header {
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
      font-size: var(--font-size-small-desktop);
      font-weight: 600;
      color: var(--color-gray-700);
    }

    .chat-question-content {
      font-size: var(--font-size-base-mobile);
      color: var(--color-gray-900);
      line-height: 1.6;
      padding-left: 28px;
    }

    .chat-answer {
      display: flex;
      flex-direction: column;
      gap: var(--spacing-xs);
      margin-top: var(--spacing-sm);
      padding-top: var(--spacing-sm);
      border-top: 1px solid var(--color-gray-300);
    }

    .chat-answer-header {
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
      font-size: var(--font-size-small-desktop);
      font-weight: 600;
      color: var(--color-primary);
    }

    .chat-answer-content {
      font-size: var(--font-size-base-mobile);
      color: var(--color-gray-700);
      line-height: 1.6;
      padding-left: 28px;
      white-space: pre-line;
    }

    .chat-timestamp {
      font-size: var(--font-size-small-mobile);
      color: var(--color-gray-500);
      margin-top: var(--spacing-xs);
      padding-left: 28px;
    }

    /* è¾“å…¥åŒºåŸŸ */
    .explore-chat-input-area {
      display: flex;
      flex-direction: column;
      gap: var(--spacing-sm);
      padding: var(--spacing-md);
      background: var(--color-white);
      border-top: 1px solid var(--color-gray-300);
    }

    .explore-chat-input {
      width: 100%;
      min-height: 80px;
      padding: var(--spacing-sm) var(--spacing-md);
      border: 1px solid var(--color-gray-300);
      border-radius: var(--radius-sm);
      font-family: var(--font-family-base);
      font-size: var(--font-size-base-mobile);
      outline: none;
      transition: border-color var(--transition-fast);
      resize: vertical;
    }

    .explore-chat-input:focus {
      border-color: var(--color-primary);
      box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
    }

    .explore-chat-send-btn {
      align-self: flex-end;
      padding: var(--spacing-sm) var(--spacing-lg);
      background: var(--color-primary);
      color: white;
      border: none;
      border-radius: var(--radius-sm);
      cursor: pointer;
      font-weight: 600;
      transition: all var(--transition-fast);
    }

    .explore-chat-send-btn:hover {
      background: var(--color-primary);
      opacity: 0.9;
      transform: translateY(-1px);
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .toolbar-divider {
      width: 1px;
      background: var(--color-gray-300);
      margin: 0 var(--spacing-xs);
    }

    .note-editor {
      flex: 1;
      padding: var(--spacing-xl);
      overflow-y: auto;
    }

    .note-textarea {
      width: 100%;
      height: 100%;
      min-height: 500px;
      border: none;
      resize: none;
      font-family: var(--font-family-base);
      font-size: var(--font-size-base-desktop);
      line-height: var(--line-height-loose);
      color: var(--color-gray-900);
    }

    .note-textarea:focus {
      outline: none;
    }

    .summary-row-header {
      padding: var(--spacing-sm) var(--spacing-md);
      background: var(--color-white);
      border-bottom: 1px solid var(--color-gray-300);
      display: flex;
      align-items: center;
      justify-content: space-between;
      min-height: 52px;
    }

    .summary-row-title {
      font-size: var(--font-size-h2-mobile);
      font-weight: 700;
      color: var(--color-gray-900);
    }

    .save-status {
      font-size: var(--font-size-small-mobile);
      color: var(--color-gray-500);
    }

    .summary-content {
      flex: 1;
      display: flex;
      flex-direction: column;
      overflow-y: auto;
      padding: var(--spacing-md);
    }


    .summary-textarea {
      width: 100%;
      height: 100%;
      flex: 1;
      border: none;
      resize: none;
      font-family: var(--font-family-base);
      font-size: var(--font-size-base-mobile);
      line-height: 1.8;
      background: transparent;
      color: var(--color-gray-900);
      padding: 0;
      margin: 0;
    }

    .summary-textarea:focus {
      outline: none;
    }

    /* ç§»åŠ¨ç«¯é€‚é… */
    @media (max-width: 767px) {
      .editor-three-columns {
        flex-direction: column;
      }

      .cue-column,
      .note-column {
        width: 100%;
      }

      .cue-column {
        display: none; /* ç§»åŠ¨ç«¯é»˜è®¤éšè— */
      }

      .summary-row {
        display: none; /* ç§»åŠ¨ç«¯é»˜è®¤éšè— */
      }

      /* æ·»åŠ æ ‡ç­¾é¡µåˆ‡æ¢ */
      .mobile-tabs {
        display: flex;
        background: var(--color-white);
        border-bottom: 1px solid var(--color-gray-300);
      }

      .mobile-tab {
        flex: 1;
        padding: var(--spacing-md);
        text-align: center;
        cursor: pointer;
        border-bottom: 2px solid transparent;
      }

      .mobile-tab.active {
        color: var(--color-primary);
        border-bottom-color: var(--color-primary);
        font-weight: 600;
      }
    }
  </style>
</head>
<body>
  <div class="editor-page">
    <!-- é¡¶éƒ¨æ ‡é¢˜æ  -->
    <header class="editor-header">
      <button class="btn btn-secondary" onclick="window.location.href='index.html'">
        â† è¿”å›
      </button>
      <input
        type="text"
        class="editor-title-input"
        placeholder="æœªå‘½åç¬”è®°"
        value="åº·å¥ˆå°”ç¬”è®°æ³•ä»‹ç»"
      />
      <div class="editor-actions">
        <div class="save-status" id="saveStatus">å·²ä¿å­˜ 14:32</div>
        <button class="btn btn-secondary" id="toggleSidebars" title="æ˜¾ç¤º/éšè—è¾…åŠ©æ ">
          ğŸ“ è¾…åŠ©æ 
        </button>
        <button class="btn btn-secondary" id="toggleExploreChat" title="æ·±åº¦æ¢ç´¢">
          ğŸ’­ æ·±åº¦æ¢ç´¢
        </button>
        <button class="btn btn-primary" id="saveBtn">ğŸ’¾ ä¿å­˜</button>
      </div>
    </header>

    <!-- ç¼–è¾‘å™¨å®¹å™¨ -->
    <div class="editor-container">
      <div class="editor-three-columns">

        <!-- çº¿ç´¢æ  (25%) -->
        <aside class="cue-column">
          <div class="cue-column-header">
            <h2 class="cue-column-title">ğŸ“Œ çº¿ç´¢</h2>
          </div>
          <div class="cue-column-content">
            <textarea
              class="cue-textarea"
              placeholder="è¾“å…¥å…³é”®è¯ã€é—®é¢˜æˆ–é‡ç‚¹..."
            >ä»€ä¹ˆæ˜¯åº·å¥ˆå°”ç¬”è®°æ³•ï¼Ÿ
5R æµç¨‹æ˜¯ä»€ä¹ˆï¼Ÿ
å¦‚ä½•æœ‰æ•ˆä½¿ç”¨çº¿ç´¢æ ï¼Ÿ
ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ä¸‰åˆ†æ å¸ƒå±€ï¼Ÿ</textarea>
          </div>
        </aside>

        <!-- ç¬”è®°æ  (75%) -->
        <main class="note-column">
          <!-- å·¥å…·æ  -->
          <div class="toolbar">
            <!-- åŸºç¡€æ ¼å¼ -->
            <button class="toolbar-btn" title="åŠ ç²—">B</button>
            <button class="toolbar-btn" title="æ–œä½“">I</button>
            <button class="toolbar-btn" title="ä¸‹åˆ’çº¿">U</button>
            <button class="toolbar-btn" title="åˆ é™¤çº¿">S</button>
            <div class="toolbar-divider"></div>

            <!-- åˆ—è¡¨ -->
            <button class="toolbar-btn" title="æœ‰åºåˆ—è¡¨">1.</button>
            <button class="toolbar-btn" title="æ— åºåˆ—è¡¨">â€¢</button>
            <button class="toolbar-btn" title="ä»»åŠ¡æ¸…å•">â˜</button>
            <div class="toolbar-divider"></div>

            <!-- æ’å…¥ -->
            <button class="toolbar-btn" title="æ’å…¥å›¾ç‰‡">ğŸ–¼</button>
            <button class="toolbar-btn" title="æ’å…¥ä»£ç ">&lt;/&gt;</button>
            <button class="toolbar-btn" title="æ’å…¥å…¬å¼">âˆ‘</button>
            <button class="toolbar-btn" title="æ’å…¥è¡¨æ ¼">âŠ</button>
            <div class="toolbar-divider"></div>

            <!-- é«˜äº® -->
            <button class="toolbar-btn" style="background: rgba(255, 153, 0, 0.3);" title="é‡ç‚¹é—®é¢˜"></button>
            <button class="toolbar-btn" style="background: rgba(153, 0, 255, 0.3);" title="åæ€å¿ƒå¾—"></button>
            <button class="toolbar-btn" style="background: rgba(255, 51, 51, 0.3);" title="è­¦ç¤ºæ˜“é”™"></button>
            <div class="toolbar-divider"></div>

            <!-- AI åŠŸèƒ½ -->
            <button class="toolbar-btn ai-feature-btn" id="aiExtractCues" title="AI æç‚¼çº¿ç´¢" data-feature="extract-cues">ğŸ§ </button>
            <button class="toolbar-btn ai-feature-btn" id="aiHighlight" title="AI é«˜äº®å†…å®¹" data-feature="highlight">âœ¨</button>
            <button class="toolbar-btn ai-feature-btn" id="aiMindmap" title="AI æ€ç»´å¯¼å›¾" data-feature="mindmap">ğŸ—ºï¸</button>
          </div>

          <!-- ç¬”è®°ç¼–è¾‘åŒº -->
          <div class="note-editor">
            <textarea class="note-textarea" placeholder="å¼€å§‹è®°å½•ä½ çš„ç¬”è®°...">åº·å¥ˆå°”ç¬”è®°æ³•æ˜¯ä¸€ç§<span class="highlight-core">ç³»ç»ŸåŒ–çš„ç¬”è®°æ–¹æ³•</span>ï¼Œç”±åº·å¥ˆå°”å¤§å­¦æ•™æˆ Walter Pauk äº 1950 å¹´ä»£å‘æ˜ã€‚

è¯¥æ–¹æ³•çš„æ ¸å¿ƒæ˜¯å°†ç¬”è®°é¡µé¢åˆ†ä¸ºä¸‰ä¸ªåŒºåŸŸï¼š

1. çº¿ç´¢æ ï¼ˆCue Columnï¼‰- å·¦ä¾§ï¼Œçº¦å  25%
   è®°å½•å…³é”®è¯ã€é—®é¢˜å’Œæç¤º

2. ç¬”è®°æ ï¼ˆNote Columnï¼‰- å³ä¾§ï¼Œçº¦å  75%
   è®°å½•è¯¾å ‚å†…å®¹ã€è®²åº§ç¬”è®°æˆ–é˜…è¯»è¦ç‚¹

3. æ€»ç»“æ ï¼ˆSummary Rowï¼‰- åº•éƒ¨ï¼Œçº¦å  20%
   æ¦‚æ‹¬æ€»ç»“æœ¬é¡µçš„æ ¸å¿ƒå†…å®¹

<span class="highlight-problem">ä¸ºä»€ä¹ˆåº·å¥ˆå°”ç¬”è®°æ³•æœ‰æ•ˆï¼Ÿ</span>

å› ä¸ºå®ƒéµå¾ª <span class="highlight-core">5R æµç¨‹</span>ï¼š
â€¢ Recordï¼ˆè®°å½•ï¼‰- åœ¨ç¬”è®°æ è®°å½•ä¸»è¦å†…å®¹
â€¢ Reduceï¼ˆç®€åŒ–ï¼‰- åœ¨çº¿ç´¢æ æç‚¼å…³é”®è¯å’Œé—®é¢˜
â€¢ Reciteï¼ˆèƒŒè¯µï¼‰- é®ç›–ç¬”è®°æ ï¼Œæ ¹æ®çº¿ç´¢å›å¿†
â€¢ Reflectï¼ˆåæ€ï¼‰- æ€è€ƒå†…å®¹çš„æ„ä¹‰å’Œè”ç³»
â€¢ Reviewï¼ˆå¤ä¹ ï¼‰- å®šæœŸå›é¡¾å’Œæ€»ç»“

<span class="highlight-case">ä½¿ç”¨æ¡ˆä¾‹</span>ï¼š
å­¦ç”Ÿ A åœ¨ä½¿ç”¨åº·å¥ˆå°”ç¬”è®°æ³•åï¼Œè€ƒè¯•æˆç»©æå‡äº† 20%ã€‚åŸå› æ˜¯ï¼š
1. çº¿ç´¢æ çš„é—®é¢˜å¼•å¯¼ä¸»åŠ¨æ€è€ƒ
2. æ€»ç»“æ å¸®åŠ©æ¢³ç†çŸ¥è¯†ç»“æ„
3. å®šæœŸå¤ä¹ åŠ æ·±è®°å¿†

<span class="highlight-reflection">ä¸ªäººå¿ƒå¾—</span>ï¼š
åº·å¥ˆå°”ç¬”è®°æ³•ä¸ä»…æ˜¯è®°å½•å·¥å…·ï¼Œæ›´æ˜¯å­¦ä¹ æ–¹æ³•ã€‚é€šè¿‡ç³»ç»ŸåŒ–çš„æµç¨‹ï¼Œå°†è¢«åŠ¨æ¥æ”¶è½¬å˜ä¸ºä¸»åŠ¨æ€è€ƒã€‚

<span class="highlight-alert">å¸¸è§è¯¯åŒº</span>ï¼š
â€¢ ä¸è¦åœ¨ä¸Šè¯¾æ—¶å°±å¡«å†™çº¿ç´¢æ ï¼ˆåº”è¯¥è¯¾åæ•´ç†ï¼‰
â€¢ æ€»ç»“æ ä¸æ˜¯ç®€å•çš„æ‘˜æŠ„ï¼Œè€Œæ˜¯ç”¨è‡ªå·±çš„è¯æ¦‚æ‹¬
â€¢ å¤ä¹ æ—¶è¦é®ç›–ç¬”è®°æ ï¼Œåªçœ‹çº¿ç´¢æ è¿›è¡Œå›å¿†</textarea>
          </div>
        </main>

        <!-- æ€»ç»“æ ï¼ˆåº•éƒ¨ 20% / å®½å±å³ä¾§ 25%ï¼‰ -->
        <section class="summary-row">
        <div class="summary-row-header">
          <h2 class="summary-row-title">ğŸ’¡ æ€»ç»“</h2>
          <button class="toolbar-btn" id="aiGapCheckBtn" title="AI æŸ¥æ¼è¡¥ç¼º">ğŸ”</button>
        </div>
        <div class="summary-content">
          <textarea class="summary-textarea" placeholder="æ€»ç»“æœ¬é¡µçš„æ ¸å¿ƒå†…å®¹...">åº·å¥ˆå°”ç¬”è®°æ³•é€šè¿‡ä¸‰æ å¸ƒå±€å’Œ 5R æµç¨‹ï¼Œå°†ç¬”è®°è®°å½•è½¬åŒ–ä¸ºç³»ç»ŸåŒ–çš„å­¦ä¹ è¿‡ç¨‹ã€‚å…³é”®åœ¨äºçº¿ç´¢æ çš„ä¸»åŠ¨æé—®å’Œå®šæœŸå¤ä¹ ã€‚</textarea>
        </div>
      </section>

      </div> <!-- å…³é—­ .editor-three-columns -->
    </div> <!-- å…³é—­ .editor-container -->

    <!-- æ·±åº¦æ¢ç´¢å¯¹è¯é¢æ¿ - æµ®åŠ¨å±‚ -->
    <aside class="explore-chat-panel" id="exploreChatPanel">
      <div class="explore-chat-header">
        <h2 class="explore-chat-title">
          <span>ğŸ’­</span>
          <span>æ·±åº¦æ¢ç´¢</span>
        </h2>
        <button class="explore-chat-close-btn" id="closeExploreChatBtn" title="å…³é—­">
          âœ•
        </button>
      </div>

      <div class="explore-chat-content">
        <div class="explore-chat-messages" id="exploreChatMessages">
          <!-- å¯¹è¯å†å²å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
        </div>

        <div class="explore-chat-input-area">
          <textarea
            class="explore-chat-input"
            id="exploreChatInput"
            placeholder="è¾“å…¥ä½ çš„é—®é¢˜ï¼Œæ·±å…¥æ¢ç´¢çŸ¥è¯†...&#10;&#10;ä¾‹å¦‚ï¼š&#10;â€¢ ä»€ä¹ˆæ˜¯å…‰åˆä½œç”¨ï¼Ÿ&#10;â€¢ è¯¦ç»†è¯´è¯´æš—ååº”çš„è¿‡ç¨‹"
            rows="3"
          ></textarea>
          <button class="explore-chat-send-btn" id="exploreChatSendBtn">å‘é€</button>
        </div>
      </div>
    </aside>

  </div> <!-- å…³é—­ .editor-page -->

  <script>
    // ===== æ™ºèƒ½å¸ƒå±€ç³»ç»Ÿï¼ˆä¸‰çº§å“åº”å¼æ–­ç‚¹ï¼‰ =====
    function detectLayoutMode() {
      const screenWidth = window.innerWidth;
      let mode = 'classic';  // é»˜è®¤ç»å…¸æ¨¡å¼
      let modeLabel = 'ç»å…¸æ¨¡å¼ï¼ˆä¸¤æ +åº•éƒ¨ï¼‰';
      let layoutInfo = '   çº¿ç´¢æ : 25% | ç¬”è®°æ : 75%\n   æ€»ç»“æ : åº•éƒ¨ 20% é«˜åº¦';

      if (screenWidth >= 1600) {
        mode = 'ultra-wide';
        modeLabel = 'è¶…å®½å±æ¨¡å¼ï¼ˆä¸‰æ ä¼˜åŒ–ï¼‰';
        layoutInfo = '   çº¿ç´¢æ : 20% | ç¬”è®°æ : 52% | æ€»ç»“æ : 28%ï¼ˆå³ä¾§ï¼‰';
      } else if (screenWidth >= 1024) {
        mode = 'wide';
        modeLabel = 'æ¨ªå±æ¨¡å¼ï¼ˆä¸‰æ ï¼‰';
        layoutInfo = '   çº¿ç´¢æ : 20% | ç¬”è®°æ : 55% | æ€»ç»“æ : 25%ï¼ˆå³ä¾§ï¼‰';
      }

      console.log('ğŸ“ å±å¹•å®½åº¦:', screenWidth + 'px');
      console.log('ğŸ–¥ï¸ å¸ƒå±€æ¨¡å¼:', modeLabel);
      console.log(layoutInfo);

      return { mode, screenWidth };
    }

    // é¡µé¢åŠ è½½æ—¶æ£€æµ‹
    window.addEventListener('DOMContentLoaded', () => {
      console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
      console.log('ğŸ¨ åº·å¥ˆå°”ç¬”è®°ç¼–è¾‘å™¨ - æ™ºèƒ½å¸ƒå±€ç³»ç»Ÿ');
      console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
      const result = detectLayoutMode();
      console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');

      // æ˜¾ç¤ºè®¾å¤‡ç±»å‹æç¤º
      if (result.screenWidth < 768) {
        console.log('ğŸ“± è®¾å¤‡ç±»å‹: æ‰‹æœº');
      } else if (result.screenWidth < 1024) {
        console.log('ğŸ“± è®¾å¤‡ç±»å‹: å¹³æ¿ç«–å± / å°å±ç¬”è®°æœ¬');
      } else if (result.screenWidth < 1600) {
        console.log('ğŸ’» è®¾å¤‡ç±»å‹: å¹³æ¿æ¨ªå± / ç¬”è®°æœ¬');
      } else {
        console.log('ğŸ–¥ï¸ è®¾å¤‡ç±»å‹: æ¡Œé¢æ˜¾ç¤ºå™¨ / å®½å±');
      }
      console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
    });

    // çª—å£å¤§å°æ”¹å˜æ—¶é‡æ–°æ£€æµ‹
    let resizeTimeout;
    window.addEventListener('resize', () => {
      clearTimeout(resizeTimeout);
      resizeTimeout = setTimeout(() => {
        console.log('\nğŸ”„ çª—å£å¤§å°å·²æ”¹å˜ï¼Œé‡æ–°æ£€æµ‹å¸ƒå±€...');
        const result = detectLayoutMode();

        // æ˜¾ç¤ºåˆ‡æ¢æç¤º
        showLayoutSwitchNotification(result.mode);
      }, 500);
    });

    // æ˜¾ç¤ºå¸ƒå±€åˆ‡æ¢é€šçŸ¥
    function showLayoutSwitchNotification(mode) {
      const existingNotif = document.querySelector('.layout-switch-notif');
      if (existingNotif) existingNotif.remove();

      let text = 'ğŸ“± å·²åˆ‡æ¢åˆ°ç»å…¸æ¨¡å¼';
      if (mode === 'wide') {
        text = 'ğŸ–¥ï¸ å·²åˆ‡æ¢åˆ°æ¨ªå±æ¨¡å¼';
      } else if (mode === 'ultra-wide') {
        text = 'ğŸ–¥ï¸ å·²åˆ‡æ¢åˆ°è¶…å®½å±æ¨¡å¼';
      }

      const notif = document.createElement('div');
      notif.className = 'layout-switch-notif';
      notif.textContent = text;
      notif.style.cssText = `
        position: fixed;
        top: 80px;
        right: 20px;
        background: rgba(67, 97, 238, 0.95);
        color: white;
        padding: 12px 20px;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 600;
        z-index: 10000;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        animation: slideInFadeOut 3s ease-in-out forwards;
      `;

      const style = document.createElement('style');
      style.textContent = `
        @keyframes slideInFadeOut {
          0% { opacity: 0; transform: translateX(20px); }
          10% { opacity: 1; transform: translateX(0); }
          90% { opacity: 1; transform: translateX(0); }
          100% { opacity: 0; transform: translateX(20px); }
        }
      `;
      document.head.appendChild(style);

      document.body.appendChild(notif);
      setTimeout(() => notif.remove(), 3000);
    }

    // ===== è‡ªåŠ¨ä¿å­˜åŠŸèƒ½æ¼”ç¤º =====
    let saveTimeout;
    const saveStatus = document.getElementById('saveStatus');

    function autoSave() {
      clearTimeout(saveTimeout);
      saveStatus.textContent = 'ä¿å­˜ä¸­...';

      saveTimeout = setTimeout(() => {
        const now = new Date();
        const timeStr = `${now.getHours()}:${String(now.getMinutes()).padStart(2, '0')}`;
        saveStatus.textContent = `å·²ä¿å­˜ ${timeStr}`;
        console.log('ğŸ’¾ ç¬”è®°å·²è‡ªåŠ¨ä¿å­˜');
      }, 2000);
    }

    // ç›‘å¬æ‰€æœ‰ textarea çš„è¾“å…¥
    document.querySelectorAll('textarea').forEach(textarea => {
      textarea.addEventListener('input', autoSave);
    });

    // å·¥å…·æ æŒ‰é’®åŠŸèƒ½
    document.querySelectorAll('.toolbar-btn:not(.ai-feature-btn)').forEach(btn => {
      btn.addEventListener('click', () => {
        btn.classList.toggle('active');
        console.log('å·¥å…·æ æ“ä½œ:', btn.title);
      });
    });

    // AI åŠŸèƒ½æŒ‰é’®
    document.querySelectorAll('.ai-feature-btn').forEach(btn => {
      btn.addEventListener('click', (e) => {
        e.preventDefault();
        const feature = btn.getAttribute('data-feature');
        let message = '';

        switch(feature) {
          case 'extract-cues':
            message = 'ğŸ§  AI æ­£åœ¨æç‚¼çº¿ç´¢...';
            break;
          case 'highlight':
            message = 'âœ¨ AI æ­£åœ¨é«˜äº®å†…å®¹...';
            break;
          case 'mindmap':
            message = 'ğŸ—ºï¸ AI æ­£åœ¨ç”Ÿæˆæ€ç»´å¯¼å›¾...';
            break;
        }

        console.log(message);
        alert('AI åŠŸèƒ½å¼€å‘ä¸­...\n' + message);
      });
    });

    // AI åŠŸèƒ½æ¼”ç¤º
    document.querySelectorAll('.ai-generate-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        alert('AI åŠŸèƒ½å¼€å‘ä¸­...');
      });
    });

    // ä¿å­˜æŒ‰é’®åŠŸèƒ½
    const saveBtn = document.getElementById('saveBtn');
    if (saveBtn) {
      saveBtn.addEventListener('click', () => {
        // æ‰‹åŠ¨è§¦å‘ä¿å­˜
        autoSave();

        // æ˜¾ç¤ºä¿å­˜æˆåŠŸæç¤º
        const originalText = saveBtn.textContent;
        saveBtn.textContent = 'âœ… å·²ä¿å­˜';
        saveBtn.disabled = true;

        setTimeout(() => {
          saveBtn.textContent = originalText;
          saveBtn.disabled = false;
        }, 2000);

        console.log('ğŸ’¾ ç¬”è®°å·²æ‰‹åŠ¨ä¿å­˜');
      });
    }

    // ===== AI æŸ¥æ¼è¡¥ç¼ºåŠŸèƒ½ =====
    const aiGapCheckBtn = document.getElementById('aiGapCheckBtn');
    if (aiGapCheckBtn) {
      aiGapCheckBtn.addEventListener('click', () => {
        const summaryContent = document.querySelector('.summary-textarea').value;
        if (!summaryContent.trim()) {
          alert('è¯·å…ˆå¡«å†™æ€»ç»“å†…å®¹ï¼ŒAI æ‰èƒ½è¿›è¡ŒæŸ¥æ¼è¡¥ç¼ºåˆ†æ');
          return;
        }
        alert('ğŸ” AI æ­£åœ¨åˆ†ææ€»ç»“å†…å®¹...\n\nåŠŸèƒ½å¼€å‘ä¸­ï¼š\nâ€¢ æ£€æŸ¥çŸ¥è¯†ç›²ç‚¹\nâ€¢ å‘ç°é—æ¼çš„å…³é”®æ¦‚å¿µ\nâ€¢ æä¾›è¡¥å……å»ºè®®');
        console.log('ğŸ” AI æŸ¥æ¼è¡¥ç¼ºåˆ†æå·²å¯åŠ¨');
      });
    }

    // ===== æ·±åº¦æ¢ç´¢å¯¹è¯é¢æ¿åŠŸèƒ½ =====
    const toggleExploreChatBtn = document.getElementById('toggleExploreChat');
    const closeExploreChatBtn = document.getElementById('closeExploreChatBtn');
    const exploreChatPanel = document.getElementById('exploreChatPanel');
    const exploreChatInput = document.getElementById('exploreChatInput');
    const exploreChatSendBtn = document.getElementById('exploreChatSendBtn');
    const exploreChatMessages = document.getElementById('exploreChatMessages');

    let chatOpen = false;
    let chatHistory = [];

    // æ‰“å¼€å¯¹è¯é¢æ¿
    if (toggleExploreChatBtn) {
      toggleExploreChatBtn.addEventListener('click', () => {
        chatOpen = true;
        exploreChatPanel.classList.add('open');
        toggleExploreChatBtn.classList.add('active');

        // ç„¦ç‚¹åˆ°è¾“å…¥æ¡†
        setTimeout(() => exploreChatInput.focus(), 300);

        console.log('ğŸ’­ æ·±åº¦æ¢ç´¢é¢æ¿å·²æ‰“å¼€');
      });
    }

    // å…³é—­å¯¹è¯é¢æ¿
    if (closeExploreChatBtn) {
      closeExploreChatBtn.addEventListener('click', () => {
        chatOpen = false;
        exploreChatPanel.classList.remove('open');
        toggleExploreChatBtn.classList.remove('active');

        console.log('ğŸ’­ æ·±åº¦æ¢ç´¢é¢æ¿å·²å…³é—­');
      });
    }

    // å‘é€æ¶ˆæ¯
    function sendMessage() {
      const question = exploreChatInput.value.trim();
      if (!question) return;

      // æ·»åŠ ç”¨æˆ·é—®é¢˜
      addChatMessage('user', question);

      // æ¸…ç©ºè¾“å…¥æ¡†
      exploreChatInput.value = '';

      // æ¨¡æ‹ŸAIå›ç­”ï¼ˆå®é™…åº”è¯¥è°ƒç”¨APIï¼‰
      setTimeout(() => {
        const answer = generateMockAnswer(question);
        addChatMessage('assistant', answer);
      }, 1000);
    }

    // æ·»åŠ å¯¹è¯æ¶ˆæ¯
    function addChatMessage(role, content) {
      const timestamp = new Date().toLocaleTimeString('zh-CN', {
        hour: '2-digit',
        minute: '2-digit'
      });

      // å¦‚æœæ˜¯æ–°çš„QAå¯¹ï¼Œåˆ›å»ºæ–°çš„QAé¡¹
      if (role === 'user') {
        const qaItem = document.createElement('div');
        qaItem.className = 'chat-qa-item';
        qaItem.dataset.timestamp = Date.now();

        qaItem.innerHTML = `
          <div class="chat-question">
            <div class="chat-question-header">
              <span>ğŸ™‹</span>
              <span>æˆ‘çš„é—®é¢˜</span>
            </div>
            <div class="chat-question-content">${content}</div>
            <div class="chat-timestamp">${timestamp}</div>
          </div>
        `;

        exploreChatMessages.appendChild(qaItem);
        exploreChatMessages.scrollTop = exploreChatMessages.scrollHeight;

        // ä¿å­˜åˆ°å†å²
        chatHistory.push({ role, content, timestamp });
      } else {
        // æ‰¾åˆ°æœ€åä¸€ä¸ªQAé¡¹ï¼Œæ·»åŠ ç­”æ¡ˆ
        const lastQA = exploreChatMessages.querySelector('.chat-qa-item:last-child');
        if (lastQA) {
          const answerDiv = document.createElement('div');
          answerDiv.className = 'chat-answer';
          answerDiv.innerHTML = `
            <div class="chat-answer-header">
              <span>ğŸ¤–</span>
              <span>AI å›ç­”</span>
            </div>
            <div class="chat-answer-content">${content}</div>
            <div class="chat-timestamp">${timestamp}</div>
          `;
          lastQA.appendChild(answerDiv);
          exploreChatMessages.scrollTop = exploreChatMessages.scrollHeight;

          // ä¿å­˜åˆ°å†å²
          chatHistory.push({ role, content, timestamp });
        }
      }
    }

    // æ¨¡æ‹ŸAIå›ç­”
    function generateMockAnswer(question) {
      const answers = {
        'å…‰åˆä½œç”¨': 'å…‰åˆä½œç”¨æ˜¯æ¤ç‰©ã€è—»ç±»å’ŒæŸäº›ç»†èŒåˆ©ç”¨å…‰èƒ½ï¼Œå°†äºŒæ°§åŒ–ç¢³å’Œæ°´è½¬åŒ–ä¸ºæœ‰æœºç‰©ï¼Œå¹¶é‡Šæ”¾æ°§æ°”çš„è¿‡ç¨‹ã€‚\n\nåŸºæœ¬åŸç†åŒ…æ‹¬ï¼š\n1. å…‰ååº”ï¼šåœ¨å¶ç»¿ä½“çš„ç±»å›Šä½“è†œä¸Šè¿›è¡Œï¼Œå…‰èƒ½è½¬åŒ–ä¸ºåŒ–å­¦èƒ½\n2. æš—ååº”ï¼šåœ¨å¶ç»¿ä½“åŸºè´¨ä¸­è¿›è¡Œï¼Œåˆ©ç”¨å…‰ååº”äº§ç”Ÿçš„èƒ½é‡å›ºå®šCOâ‚‚',
        'æš—ååº”': 'æš—ååº”åˆç§°å¡å°”æ–‡å¾ªç¯ï¼Œæ˜¯å…‰åˆä½œç”¨çš„ç¬¬äºŒé˜¶æ®µã€‚ä¸»è¦è¿‡ç¨‹ï¼š\n\n1. COâ‚‚å›ºå®šï¼šCOâ‚‚ä¸RuBPç»“åˆ\n2. è¿˜åŸï¼šåˆ©ç”¨ATPå’ŒNADPHå°†3-ç£·é…¸ç”˜æ²¹é…¸è¿˜åŸ\n3. RuBPå†ç”Ÿï¼šéƒ¨åˆ†äº§ç‰©ç”¨äºå†ç”ŸRuBP\n\næ•´ä¸ªè¿‡ç¨‹ä¸éœ€è¦å…‰ï¼Œä½†éœ€è¦å…‰ååº”æä¾›çš„ATPå’ŒNADPHã€‚',
        'å¶ç»¿ä½“': 'å¶ç»¿ä½“æ˜¯æ¤ç‰©ç»†èƒä¸­è¿›è¡Œå…‰åˆä½œç”¨çš„ç»†èƒå™¨ã€‚ç»“æ„åŒ…æ‹¬ï¼š\n\nâ€¢ å¤–è†œå’Œå†…è†œï¼šåŒå±‚è†œç»“æ„\nâ€¢ ç±»å›Šä½“ï¼šè¿›è¡Œå…‰ååº”çš„åœºæ‰€\nâ€¢ åŸºè´¨ï¼šè¿›è¡Œæš—ååº”çš„åœºæ‰€\nâ€¢ å¶ç»¿ç´ ï¼šå¸æ”¶å…‰èƒ½çš„è‰²ç´ \n\nå¶ç»¿ä½“æ˜¯åŠè‡ªä¸»æ€§ç»†èƒå™¨ï¼Œå«æœ‰è‡ªå·±çš„DNAå’Œæ ¸ç³–ä½“ã€‚'
      };

      // ç®€å•çš„å…³é”®è¯åŒ¹é…
      for (const [key, value] of Object.entries(answers)) {
        if (question.includes(key)) {
          return value;
        }
      }

      return 'è¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é—®é¢˜ï¼è®©æˆ‘æ¥å¸®ä½ åˆ†æä¸€ä¸‹...\n\nï¼ˆè¿™æ˜¯ä¸€ä¸ªæ¨¡æ‹Ÿå›ç­”ï¼Œå®é™…åº”ç”¨ä¸­ä¼šè°ƒç”¨çœŸå®çš„AI APIæ¥ç”Ÿæˆå›ç­”ï¼‰';
    }

    // å‘é€æŒ‰é’®ç‚¹å‡»
    if (exploreChatSendBtn) {
      exploreChatSendBtn.addEventListener('click', sendMessage);
    }

    // è¾“å…¥æ¡†å›è½¦å‘é€ï¼ˆCtrl+Enterï¼‰
    if (exploreChatInput) {
      exploreChatInput.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' && e.ctrlKey) {
          e.preventDefault();
          sendMessage();
        }
      });
    }

    // ===== æŠ˜å /å±•å¼€åŠŸèƒ½ =====
    const cueColumn = document.querySelector('.cue-column');
    const summaryRow = document.querySelector('.summary-row');
    const noteColumn = document.querySelector('.note-column');
    // editorThreeColumns å·²åœ¨ä¸Šé¢å£°æ˜
    const toggleSidebarsBtn = document.getElementById('toggleSidebars');

    let sidebarsVisible = true; // é»˜è®¤æ˜¾ç¤ºè¾…åŠ©æ 

    // ç»Ÿä¸€æ§åˆ¶çº¿ç´¢æ å’Œæ€»ç»“æ çš„æŠ˜å /å±•å¼€
    if (toggleSidebarsBtn) {
      toggleSidebarsBtn.addEventListener('click', () => {
        sidebarsVisible = !sidebarsVisible;

        if (sidebarsVisible) {
          // å±•å¼€è¾…åŠ©æ 
          cueColumn.classList.remove('collapsed');
          summaryRow.classList.remove('collapsed');
          editorThreeColumns.classList.remove('focus-mode');
          toggleSidebarsBtn.textContent = 'ğŸ“ è¾…åŠ©æ ';
          console.log('ğŸ“ è¾…åŠ©æ å·²å±•å¼€');
        } else {
          // æŠ˜å è¾…åŠ©æ 
          cueColumn.classList.add('collapsed');
          summaryRow.classList.add('collapsed');
          editorThreeColumns.classList.add('focus-mode');
          toggleSidebarsBtn.textContent = 'ğŸ“ ä¸“æ³¨';
          console.log('ğŸ“ å·²è¿›å…¥ä¸“æ³¨æ¨¡å¼');
        }
      });
    }
  </script>
</body>
</html>
